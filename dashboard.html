<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S-IMSY Reporting Portal - Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/styles.css">
<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: { display: ['Space Grotesk', 'sans-serif'], body: ['Inter', 'sans-serif'] },
      colors: {
        simsy: {
          blue: '#0ea5e9', 'blue-deep': '#0369a1', cyan: '#22d3ee',
          purple: '#8b5cf6', green: '#10b981', orange: '#f59e0b',
          dark: '#0a0e1a', navy: '#111827', surface: '#1e293b',
          'surface-light': '#283548', 'grey-dark': '#334155',
          grey: '#94a3b8', white: '#f8fafc',
        }
      }
    }
  }
}
</script>
<style>
  body { font-family: 'Inter', sans-serif; }
  .font-display { font-family: 'Space Grotesk', sans-serif; }
</style>
</head>
<body class="min-h-screen bg-simsy-dark animated-grid text-simsy-white">

  <!-- Top Navigation Bar -->
  <header class="fixed top-0 left-0 right-0 z-50 h-14 bg-simsy-navy/90 backdrop-blur-xl border-b border-simsy-grey-dark/30">
    <div class="flex items-center justify-between h-full px-4">
      <!-- Left: Logo + Hamburger -->
      <div class="flex items-center gap-3">
        <button id="sidebar-toggle" class="lg:hidden p-2 rounded-lg hover:bg-simsy-surface transition-colors text-simsy-grey">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-simsy-blue to-simsy-cyan flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
          </svg>
        </div>
        <span class="font-display font-bold text-sm text-simsy-white">S-IMSY Reporting</span>
      </div>

      <!-- Center: Breadcrumb -->
      <div class="hidden md:flex items-center gap-2 text-sm">
        <span id="breadcrumb-org" class="text-simsy-grey"></span>
        <svg class="w-4 h-4 text-simsy-grey-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        <span id="breadcrumb-view" class="text-simsy-white">Dashboard</span>
      </div>

      <!-- Right: User & Actions -->
      <div class="flex items-center gap-3">
        <a href="api-docs.html" class="p-2 rounded-lg hover:bg-simsy-surface transition-colors text-simsy-grey hover:text-simsy-white" title="API Docs">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
        </a>
        <div class="h-5 w-px bg-simsy-grey-dark/50"></div>
        <div class="flex items-center gap-2">
          <div id="user-avatar" class="w-7 h-7 rounded-full bg-gradient-to-br from-simsy-blue to-simsy-purple flex items-center justify-center text-xs font-bold text-white"></div>
          <span id="user-name" class="text-sm text-simsy-grey hidden sm:block"></span>
        </div>
        <button onclick="Auth.logout()" class="p-2 rounded-lg hover:bg-simsy-surface transition-colors text-simsy-grey hover:text-red-400" title="Sign Out">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
        </button>
      </div>
    </div>
  </header>

  <div class="flex pt-14">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar border-r border-simsy-grey-dark/20 hidden lg:block">
      <nav class="p-3 space-y-1">
        <div class="px-3 py-2 text-xs font-semibold text-simsy-grey-dark uppercase tracking-wider">Overview</div>
        <a href="#overview" data-view="overview" class="sidebar-link active flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm">
          <svg class="w-4 h-4 text-simsy-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>
          Dashboard
        </a>

        <div class="px-3 pt-4 pb-2 text-xs font-semibold text-simsy-grey-dark uppercase tracking-wider">Reports</div>
        <a href="#usage" data-view="usage" class="sidebar-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-simsy-grey hover:text-simsy-white">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
          Usage Report
        </a>
        <a href="#instances" data-view="instances" class="sidebar-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-simsy-grey hover:text-simsy-white">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"/></svg>
          Bundle Report
        </a>
        <a href="#endpoints" data-view="endpoints" class="sidebar-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-simsy-grey hover:text-simsy-white">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"/></svg>
          Endpoints
        </a>

        <div class="px-3 pt-4 pb-2 text-xs font-semibold text-simsy-grey-dark uppercase tracking-wider">Analytics</div>
        <a href="#roaming" data-view="roaming" class="sidebar-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-simsy-grey hover:text-simsy-white">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064"/></svg>
          Roaming Analytics
        </a>
        <a href="#trends" data-view="trends" class="sidebar-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-simsy-grey hover:text-simsy-white">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/></svg>
          Usage Trends
        </a>
        <a href="#cost" data-view="cost" class="sidebar-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-simsy-grey hover:text-simsy-white">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Cost Analysis
        </a>
        <a href="#export" data-view="export" class="sidebar-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-simsy-grey hover:text-simsy-white">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          Export Data
        </a>

        <div class="px-3 pt-4 pb-2 text-xs font-semibold text-simsy-grey-dark uppercase tracking-wider">Settings</div>
        <a href="admin.html" id="admin-link" class="hidden sidebar-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-simsy-grey hover:text-simsy-white">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          User Management
        </a>
        <a href="api-docs.html" class="sidebar-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-simsy-grey hover:text-simsy-white">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
          API Documentation
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main id="view-container" class="lg:ml-56 flex-1 p-6 min-h-screen">
      <!-- Views are rendered here by router.js -->
      <div class="flex items-center justify-center h-64">
        <div class="spinner"></div>
      </div>
    </main>
  </div>

  <!-- Scripts: Foundation -->
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/api.js"></script>
  <script src="js/auth.js"></script>
  <!-- Scripts: Infrastructure -->
  <script src="js/components.js"></script>
  <script src="js/charts.js"></script>
  <script src="js/filters.js"></script>
  <script src="js/router.js"></script>
  <!-- Scripts: Views -->
  <script src="js/views/overview.js"></script>
  <script src="js/views/usage.js"></script>
  <script src="js/views/instances.js"></script>
  <script src="js/views/endpoints.js"></script>
  <script src="js/views/roaming.js"></script>
  <script src="js/views/trends.js"></script>
  <script src="js/views/cost.js"></script>
  <script src="js/views/export.js"></script>
  <!-- Init -->
  <script>
    // Auth guard
    if (!Auth.requireAuth()) {
      // Redirect happens in requireAuth
    } else {
      // Set user info in header
      document.getElementById('user-avatar').textContent = Auth.getInitials();
      document.getElementById('user-name').textContent = Auth.getShortName();
      document.getElementById('breadcrumb-org').textContent = Auth.getOrg();

      // Show admin link for admin users
      if (Auth.isAdmin()) {
        document.getElementById('admin-link')?.classList.remove('hidden');
      }

      // Sidebar toggle for mobile
      document.getElementById('sidebar-toggle').addEventListener('click', () => {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('hidden');
        sidebar.classList.toggle('block');
      });

      // Initialize filters (loads tenant list for admin users)
      Filters.init().then(() => {
        // Initialize router after filters are ready
        Router.init();
      });
    }
  </script>
</body>
</html>
